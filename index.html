<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flipbook PIBG</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/blasten/turn.js/turn.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

<style>
html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#1a1a1a;
    overflow:hidden;
    font-family:Arial, sans-serif;
}

/* Viewport */
#viewport {
    width:100vw;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    touch-action:none;
}

/* Zoom container */
#zoom-container {
    transition: transform .25s ease;
    transform-origin: center center;
}

/* Flipbook */
#flipbook {
    box-shadow:0 0 45px rgba(0,0,0,.9);
}

/* Page */
.page {
    width:100%;
    height:100%;
    background:#fff;
    overflow:hidden;
    position:relative;
}

/* Canvas */
canvas {
    width:100% !important;
    height:100% !important;
    display:block;
}

/* Overlay */
#overlay {
    position:fixed;
    inset:0;
    background:#000;
    z-index:3000;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    color:#fff;
}

.loader {
    width:42px;
    height:42px;
    border:4px solid #333;
    border-top:4px solid #c5a059;
    border-radius:50%;
    animation:spin 1s linear infinite;
    margin-bottom:18px;
}

@keyframes spin { 100% { transform:rotate(360deg); } }

.start-btn {
    background:#c5a059;
    color:#000;
    border:none;
    padding:18px 60px;
    font-size:1.2rem;
    font-weight:bold;
    border-radius:40px;
    cursor:pointer;
    display:none;
}

/* Controls (bottom center) */
#controls {
    position:fixed;
    left:50%;
    bottom:22px;
    transform:translateX(-50%);
    z-index:2000;

    display:flex;
    align-items:center;
    gap:14px;

    background:rgba(0,0,0,.9);
    padding:10px 26px;
    border-radius:50px;
    border:1px solid #c5a059;
}

.btn {
    background:#c5a059;
    color:#000;
    border:none;
    padding:8px 18px;
    border-radius:20px;
    font-size:12px;
    font-weight:bold;
    cursor:pointer;
}

.btn-z {
    width:36px;
    height:36px;
    border-radius:50%;
    font-size:20px;
    padding:0;
}

#page-label {
    color:#fff;
    min-width:70px;
    text-align:center;
}
</style>
</head>

<body>

<!-- Overlay -->
<div id="overlay">
    <div class="loader"></div>
    <p id="status">Memuatkan Fail PDF...</p>
    <button class="start-btn" id="start-btn" onclick="openBook()">BUKA BUKU PROGRAM</button>
</div>

<!-- Viewport -->
<div id="viewport">
    <div id="zoom-container">
        <div id="flipbook"></div>
    </div>
</div>

<!-- Controls -->
<div id="controls">
    <button class="btn btn-z" onclick="zoom(-0.25)">âˆ’</button>
    <button class="btn" onclick="$('#flipbook').turn('previous')">KEMBALI</button>
    <div id="page-label"><span id="curr">1</span> / <span id="total">0</span></div>
    <button class="btn" onclick="$('#flipbook').turn('next')">TERUS</button>
    <button class="btn btn-z" onclick="zoom(0.25)">+</button>
</div>

<audio id="snd-selak" src="flip.mp3" preload="auto"></audio>

<script>
const pdfFile = 'pibg.pdf';
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';

let pdfRatio = 0.707;
let scaleZoom = 1;
let panX = 0, panY = 0;
let startPanX = 0, startPanY = 0;
let pinchStartScale = 1;

/* Load PDF */
async function initPDF() {
    try {
        const pdf = await pdfjsLib.getDocument(pdfFile).promise;
        $('#total').text(pdf.numPages);

        const first = await pdf.getPage(1);
        pdfRatio = first.view[2] / first.view[3];

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const vp = page.getViewport({ scale: 2 });

            const canvas = document.createElement('canvas');
            canvas.width = vp.width;
            canvas.height = vp.height;

            await page.render({
                canvasContext: canvas.getContext('2d'),
                viewport: vp
            }).promise;

            $('#flipbook').append(
                $('<div class="page"></div>').append(canvas)
            );

            $('#status').text(`Halaman ${i} / ${pdf.numPages}`);
        }

        $('#status').hide();
        $('#start-btn').fadeIn();
    } catch {
        $('#status').html('<b style="color:red">Fail PDF tidak dijumpai</b>');
    }
}

/* Open book */
function openBook() {
    $('#overlay').fadeOut();
    $('#flipbook').show();

    const w = window.innerWidth;
    const h = window.innerHeight;
    const isMobile = w < h;

    const display = isMobile ? 'single' : 'double';
    const ratio = isMobile ? pdfRatio : pdfRatio * 2;

    let bw = w * 0.85;
    let bh = bw / ratio;

    if (bh > h * 0.75) {
        bh = h * 0.75;
        bw = bh * ratio;
    }

    $('#flipbook').turn({
        width: bw,
        height: bh,
        display: display,
        autoCenter: true,
        acceleration: true,
        gradients: true,
        duration: 900,
        when: {
            turning() {
                const s = document.getElementById('snd-selak');
                s.currentTime = 0;
                s.play().catch(()=>{});
            },
            turned(e, p) {
                $('#curr').text(p);
            }
        }
    });
}

/* Apply transform */
function applyTransform() {
    document.getElementById('zoom-container').style.transform =
        `translate(${panX}px, ${panY}px) scale(${scaleZoom})`;
}

/* Zoom buttons */
function zoom(val) {
    scaleZoom += val;
    scaleZoom = Math.min(Math.max(scaleZoom, 0.5), 4);

    if (scaleZoom <= 1) {
        panX = 0;
        panY = 0;
    }
    applyTransform();
}

/* Pinch + Pan */
const hammer = new Hammer(document.getElementById('viewport'));
hammer.get('pinch').set({ enable:true });
hammer.get('pan').set({ direction: Hammer.DIRECTION_ALL });

hammer.on('pinchstart', () => {
    pinchStartScale = scaleZoom;
});

hammer.on('pinchmove', e => {
    scaleZoom = pinchStartScale * e.scale;
    scaleZoom = Math.min(Math.max(scaleZoom, 0.5), 4);

    if (scaleZoom <= 1) {
        panX = 0;
        panY = 0;
    }
    applyTransform();
});

hammer.on('panstart', () => {
    startPanX = panX;
    startPanY = panY;
});

hammer.on('panmove', e => {
    if (scaleZoom <= 1) return;
    panX = startPanX + e.deltaX;
    panY = startPanY + e.deltaY;
    applyTransform();
});

hammer.on('doubletap', () => {
    scaleZoom = 1;
    panX = 0;
    panY = 0;
    applyTransform();
});

$(document).ready(initPDF);
</script>

</body>
</html>
